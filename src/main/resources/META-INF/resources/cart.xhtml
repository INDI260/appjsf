<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Carrito</title>
    <style>
        body {font-family: Arial, sans-serif; background:#f5f6fa; color:#2c3e50; margin:0; padding:0;}
        .container {max-width: 720px; margin: 3rem auto; background:#fff; padding:2rem; border-radius:12px; box-shadow:0 6px 16px rgba(44,62,80,0.15);} 
        h1 {margin-top:0; font-size:1.8rem;}
        table {width:100%; border-collapse:collapse; margin-top:1.5rem;}
        thead {background:#eceff4;}
        th, td {padding:0.75rem 1rem; text-align:left; border-bottom:1px solid #e0e6f0;}
        .actions {display:flex; gap:0.5rem; align-items:center;}
        .icon-button {border:none; background:#1e88e5; color:#fff; width:36px; height:36px; border-radius:6px; font-size:1.2rem; cursor:pointer; display:flex; align-items:center; justify-content:center;}
        .icon-button.secondary {background:#eceff4; color:#2c3e50;}
        .icon-button.danger {background:#d84315;}
        .icon-button:hover {opacity:0.9;}
        .edit-block {display:flex; gap:0.5rem; align-items:center;}
        .edit-block input[type="text"] {padding:0.5rem 0.75rem; border:1px solid #cad2e2; border-radius:6px; font-size:1rem;}
        .messages {margin-bottom:1rem;}
        .empty {margin:2rem 0; text-align:center; color:#7f8c8d;}
        .footer-actions {margin-top:2rem; display:flex; justify-content:space-between; align-items:center;}
        .link-button {padding:0.6rem 1.2rem; border-radius:6px; background:#eceff4; color:#2c3e50; text-decoration:none;}
        .link-button:hover {background:#dfe6f1;}
        .button {padding:0.6rem 1.2rem; border:none; border-radius:6px; cursor:pointer; font-size:1rem;}
        .button-danger {background:#d84315; color:#fff;}
        .button-danger:hover {background:#bf360c;}
    </style>
</h:head>
<h:body>
<div class="container">
    <h1>Gestión del carrito</h1>
    <h:form id="cartForm">
        <div class="messages">
            <h:messages id="messages" globalOnly="true" showSummary="true" showDetail="false"/>
        </div>

        <h:panelGroup rendered="#{!storeBean.hasCartItems}" layout="block" styleClass="empty">
            <p>Tu carrito aún no tiene productos.</p>
            <p>
                <h:outputLink styleClass="link-button" value="/index.html">Salir</h:outputLink>
            </p>
        </h:panelGroup>

        <h:panelGroup rendered="#{storeBean.hasCartItems}" layout="block">
            <h:dataTable value="#{storeBean.cartItems}" var="item">
                <h:column>
                    <f:facet name="header">Id</f:facet>
                    <h:outputText value="#{item.product.id}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">Nombre</f:facet>
                    <h:panelGroup rendered="#{storeBean.isEditingProduct(item.product.id)}" styleClass="edit-block">
                        <h:inputText value="#{storeBean.editingProductName}" required="true" requiredMessage="El nombre es obligatorio"/>
                        <h:commandButton styleClass="button" value="Guardar" action="#{storeBean.applyEdit}"/>
                        <h:commandButton styleClass="button" value="Cancelar" action="#{storeBean.cancelEdit}" immediate="true"/>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{!storeBean.isEditingProduct(item.product.id)}">
                        <h:outputText value="#{item.product.name}"/>
                    </h:panelGroup>
                </h:column>
                <h:column>
                    <f:facet name="header">Cantidad</f:facet>
                    <h:outputText value="#{item.quantity}"/>
                </h:column>
                <h:column>
                    <f:facet name="header">Acciones</f:facet>
                    <div class="actions">
                        <h:commandButton styleClass="icon-button" value="+" action="#{storeBean.increaseQuantity(item.product.id)}" immediate="true"/>
                        <h:commandButton styleClass="icon-button secondary" value="-" action="#{storeBean.decreaseQuantity(item.product.id)}" immediate="true"/>
                        <h:commandButton styleClass="icon-button" value="✎" action="#{storeBean.startEditing(item.product.id)}" immediate="true" rendered="#{!storeBean.isEditingProduct(item.product.id)}"/>
                    </div>
                </h:column>
            </h:dataTable>

            <div class="footer-actions">
                <h:commandButton styleClass="button button-danger" value="Vaciar carrito" action="#{storeBean.clearCart}" rendered="#{storeBean.hasCartItems}" immediate="true"/>
                <h:outputLink styleClass="link-button" value="/index.html">Salir</h:outputLink>
            </div>
        </h:panelGroup>
    </h:form>
</div>
</h:body>
</html>
